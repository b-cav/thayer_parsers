# Tests for MAVLink parser

This parser can be tested in 2 different ways. Using the script `tv.sh` generates a full suite of passing and failing tests from data from an actual drone flight. Since these tests sufficiently test the capabilities of the parser, it is recommended that these tests are used for regression testing with the `runall.sh` script in the root directory. 
A larger suite of tests can be generated by running `tv.sh` with the `-l` flag. This generates a suite of tests which tests every byte value in every field.

## Contents:

* `pass.1` and `pass.2` are passing tests for two complete flights with the drone (contain multiple message types)
* `pass.3` - `pass.n` are passing tests for each individual message for two complete flights flights with the drone
* `fail.1` - `fail.n` are failing tests corresponding to `pass.1` with various fixed fields altered
* `tv.c` auto-generates a range of tests, testing all ranges of byte values for all fields
* `tvshort.c` produces failing test cases by altering bytes in fixed fields of a message from an actual drone flight
* `tv.sh [-l]` creates all of the above- and below-described test files using `tv.c` if using the `-l` flag; generates only the above-described tests if not using the '-l' flag
* Additional tests generated when using `-l` flag with `tv.sh` - generally not permanently stored in the directory due to large number of tests produced:
  * `pass.msgID.len` is a test for each possible payload length with random values assigned to wildcard fields and valid values assigned to enumerated fields 
  * `pass.msgID.len.ind.val` is a passing test for a given mesage ID at its maximum payload length (all fields present) where `ind` is the index of the payload field being tested and `val` is the byte value being tested
  * `fail.msgID.len.ind.val` is a failing test for a given mesage ID at its maximum payload length (all fields present) where `ind` is the index of the payload field being tested and `val` is the byte value being tested
  * `fail.msgID.len.header.field.val` is a failing test for a given mesage ID at its maximum payload length (all fields present) in the header field where `field` is the name of the header field being tested and val is the byte value being tested
  * `pass.msgID.len.header.field.val` is a passing test for a given mesage ID at its maximum payload length (all fields present) in the header field where `field` is the name of the header field being tested and val is the byte value being tested
  * `fail.msgID.len.extraByte` and `fail.msgID.len.oneByteLess` are failing tests for messages of the maximum length with one byte too many and one byte too few respectively
  * `pass.msgID.len.crcx.val` are passing tests for messages of the maximum length with `crc` field `x` changed such that it contains a byte of value `val` 

## Usage:

In the `../../mavlink/utils` directory:
* `make clean`
* `make`

Back in the `tests` directory:
* `make clean`
* `make`
* Either:
  * `tv.sh` to generate a basic suite of passing and failing tests
  * `./tv.sh -l` to generate an extensive suite of tests, testing each byte value in each field
