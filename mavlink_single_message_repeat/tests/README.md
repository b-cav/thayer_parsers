# Tests for MAVLink parser

This parser can be tested in 2 different ways. Using the script `tv.sh` generates a full suite of passing and failing tests from data from an actual drone flight. Since these tests sufficiently test the capabilities of the parser, it is recommended that these tests are used for regression testing with the `runall.sh` script in the root directory. 
A larger suite of tests can be generated by running `tv.sh` with the `-l` flag. This generates a suite of tests which tests every byte value in every field.

## Contents:

* `pass.1` is all of the SCALED_PRESSURE messages from a flight with the drone (run 1)
* `pass.2` is all of the SCALED_PRESSURE messages from a flight with the drone (run 2)
* `pass.3` is an empty file
* `pass.4` - `pass.n` are all of the individual SCALED_PRESSURE messages fromm two flights with the drone
* `fail.1` contains an EVENT message of the same length as a SCALED_PRESSURE message
* `fail.2` contains a SCALED_PRESSURE message and an EVENT message
* `fail.3` - `fail.n` are failing tests corresponding to `pass.4` with various fixed fields altered
* `tv.c` auto-generates a range of tests, testing all ranges of byte values for all fields
* `tvshort.c` produces failing test cases by altering bytes in fixed fields of a message from an actual drone flight
* `tv.sh [-l]` creates all of the above- and below-described test files using `tv.c` if using the `-l` flag; generates only the above-described tests if not using the '-l' flag
* Additional tests generated when using `-l` flag with `tv.sh` - generally not permanently stored in the directory due to large number of tests produced:
  * `pass.29.len` is a test for each possible payload length with random values assigned to wildcard fields and valid values assigned to enumerated fields 
  * `pass.29.16.ind.val` is a passing test for SCALED_PRESSURE message at its maximum payload length (all fields present) where `ind` is the index of the payload field being tested and `val` is the byte value being tested
  * `fail.29.16.ind.val` is a failing test for a SCALED_PRESSURE message at its maximum payload length (all fields present) where `ind` is the index of the payload field being tested and `val` is the byte value being tested
  * `fail.29.16.header.field.val` is a failing test for a SCALED_PRESSURE message at its maximum payload length (all fields present) in the header field where `field` is the name of the header field being tested and val is the byte value being tested
  * `pass.29.16.header.field.val` is a passing test for a given mesage ID at its maximum payload length (all fields present) in the header field where `field` is the name of the header field being tested and val is the byte value being tested
  * `fail.29.16.header.incompFlag.signed.val` is a failing test for a signed message (incompatibility flag is not 0x01) where val is the value of the flag being tested
  * `pass.29.16.header.incompFlag.signed.1.val` is a failing test for a signed message (incompatibility flag is 0x01) where val is the value of the byte being tests in all signature fields
  * `fail.29.16.header.incompFlag.unsigned.val` is a failing test for an usigned message (incompatibility flag is not 0x00) where val is the value of the flag being tested
  * `pass.29.16.header.incompFlag.unsigned.0` is a passing test for an usigned message (incompatibility flag is 0x00)
  * `fail.29.16.extraByte` and `fail.29.16.oneByteLess` are failing tests for messages of the maximum length with one byte too many and one byte too few respectively
  * `fail.29.16.header.field.val` is a passing test for a SCALED_PRESSURE message at its maximum payload length (all fields present) in the header field where `field` is the name of the header field being tested and val is the byte value being tested
  * `pass.29.16.crcx.val` are passing tests for messages of the maximum length with `crc` field `x` changed such that it contains a byte of value `val` 

## Usage:

In the `../../mavlink/utils` directory:
* `make clean`
* `make`

Back in the `tests` directory:
* `make clean`
* `make`
* Either:
  * `tv.sh` to generate a basic suite of passing and failing tests
  * `./tv.sh -l` to generate an extensive suite of tests, testing each byte value in each field
